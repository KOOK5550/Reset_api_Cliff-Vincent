#!/usr/bin/env node

const { NextChat } = require("./main/nextchat.js");
const colors = require("colors");
const readline = require("readline");

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout,
});

const Acsii = `NextChat CLI v1`;

async function command() {
	console.log(Acsii.bold.red);
  rl.question(colors.bold.green("Enter password (nextai): "), async (apiKey) => {
    try {
      if (apiKey === "nextai") {
        const nextChat = new NextChat("nextchat_hFaYFtodzuoSDRCE2Ex3Zu32");
        startChat(nextChat);
      }
    } catch (error) {
      if (apiKey !== "nextai") {
        console.error(colors.red("Error You Haven't typed 'nextai'"));
        command();
      }
    }
  });
}

async function startChat(nextChat) {
  console.log(colors.bold.yellow(`\nWelcome to NextChat CLI!\n`));

  function promptUser(nextChat) {
    rl.question(
      colors.green(`Enter your prompt (or type "exit" to exit): `),
      async (prompt) => {
        if (prompt.toLowerCase().trim() === "exit") {
          console.log(colors.yellow("\nExiting NextChat CLI. Goodbye!\n"));
          rl.close();
        } else {
          try {
            const response = await nextChat.gemini(prompt);
            console.log(
              colors.bold.blue(response.message)
            );
          } catch (error) {
            console.error(
              colors.red(`Error calling NextChat Api:`),
              error.message
            );
          }
          promptUser(nextChat);
        }
      }
    );
  }
	promptUser(nextChat);
}

command();